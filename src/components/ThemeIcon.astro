---

---

<div class="premium-tools">
  <button
    class="tool-btn theme-toggle-btn"
    id="sidebarThemeToggle"
    aria-label="Toggle theme"
  >
    <svg
      class="theme-icon sun"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <path
        d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"
      ></path>
    </svg>
    <svg
      class="theme-icon moon hidden"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
    >
      <path
        d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1-.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"
      ></path>
    </svg>
  </button>

  <button
    class="tool-btn"
    id="backToTop"
    aria-label="Back to top"
  >
    <svg
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M12 5V19M12 5L6 11M12 5L18 11"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        fill="none"
      ></path>
    </svg>
  </button>
</div>
<script is:inline>
  (function() {
    function setTheme(theme) {
      document.documentElement.setAttribute("data-theme", theme);
      localStorage.setItem("theme", theme);
      updateSidebarThemeIcon(theme);
    }

    function updateSidebarThemeIcon(theme) {
      const sidebarThemeToggle = document.getElementById("sidebarThemeToggle");
      if (!sidebarThemeToggle) return;
      
      const sunIcon = sidebarThemeToggle.querySelector(".sun");
      const moonIcon = sidebarThemeToggle.querySelector(".moon");
      
      if (theme === "retro-dark" || theme === "dracula") {
        if (sunIcon) sunIcon.classList.add("hidden");
        if (moonIcon) moonIcon.classList.remove("hidden");
      } else {
        if (sunIcon) sunIcon.classList.remove("hidden");
        if (moonIcon) moonIcon.classList.add("hidden");
      }
    }

    function initThemeToggle() {
      const sidebarThemeToggle = document.getElementById("sidebarThemeToggle");
      if (sidebarThemeToggle && !sidebarThemeToggle.hasAttribute('data-theme-initialized')) {
        // Mark as initialized to prevent duplicate listeners
        sidebarThemeToggle.setAttribute('data-theme-initialized', 'true');
        
        // Initialize theme icon
        const currentTheme = localStorage.getItem("theme") || "retro";
        updateSidebarThemeIcon(currentTheme);

        sidebarThemeToggle.addEventListener("click", function() {
          const currentTheme = localStorage.getItem("theme") || "retro";
          const newTheme = currentTheme === "retro" ? "retro-dark" : "retro";
          setTheme(newTheme);
        });
      }

      // Back to top functionality
      const backToTopButton = document.getElementById("backToTop");
      if (backToTopButton && !backToTopButton.hasAttribute('data-scroll-initialized')) {
        backToTopButton.setAttribute('data-scroll-initialized', 'true');
        backToTopButton.addEventListener("click", function() {
          window.scrollTo({ top: 0, behavior: "smooth" });
        });
      }
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initThemeToggle);
    } else {
      initThemeToggle();
    }

    // Re-initialize on page changes (for SPA behavior)
    document.addEventListener('astro:page-load', initThemeToggle);
    document.addEventListener('swup:page:view', initThemeToggle);
  })();
</script>

<style>
  .premium-tools {
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    margin-top: 1rem;
  }
  
  .tool-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: transparent;
    border: 1px solid var(--retro-border);
    color: var(--retro-text-light);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }
  
  .tool-btn:hover {
    background: var(--retro-accent-green);
    border-color: var(--retro-accent-green);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(53, 94, 59, 0.3);
  }
  
  .tool-btn:active {
    transform: translateY(0);
  }
  
  .theme-icon {
    width: 18px;
    height: 18px;
    fill: currentColor;
    transition: all 0.3s ease;
    position: absolute;
  }
  
  .theme-icon.hidden {
    opacity: 0;
    transform: scale(0.8) rotate(180deg);
  }
  
  .theme-icon:not(.hidden) {
    opacity: 1;
    transform: scale(1) rotate(0deg);
  }
  
  .tool-btn svg:not(.theme-icon) {
    width: 18px;
    height: 18px;
  }
  
  /* Dark theme adjustments */
  html[data-theme="retro-dark"] .tool-btn:hover,
  html[data-theme="dracula"] .tool-btn:hover {
    background: var(--retro-accent-gold);
    border-color: var(--retro-accent-gold);
    color: var(--retro-primary);
    box-shadow: 0 4px 12px rgba(197, 164, 109, 0.3);
  }
  
  /* Mobile adjustments */
  @media (max-width: 767px) {
    .premium-tools {
      gap: 0.5rem;
    }
    
    .tool-btn {
      width: 36px;
      height: 36px;
    }
    
    .theme-icon,
    .tool-btn svg:not(.theme-icon) {
      width: 16px;
      height: 16px;
    }
  }
</style>